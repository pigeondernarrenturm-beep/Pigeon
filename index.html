<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Pigeon</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;flex-direction:column;overflow:hidden;}
.container{flex:1;display:flex;flex-direction:column;background:#f5f5f5;}
.header{background:linear-gradient(135deg,#4CAF50 0%,#45a049 100%);color:white;padding:15px;text-align:center;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
.header h1{font-size:24px;font-weight:300;}
.button-grid{display:flex;flex-direction:column;gap:0;height:100%;padding:15px;}
.photo-btn{display:flex;align-items:center;justify-content:space-between;padding:60px 35px;border:none;border-radius:20px;font-size:26px;font-weight:700;color:white;cursor:pointer;transition:all .2s ease;flex:1;margin-bottom:15px;position:relative;box-shadow:0 8px 16px rgba(0,0,0,0.2);}
.photo-btn:last-child{margin-bottom:0;}
.btn-uputnica{background:linear-gradient(135deg,#ff6b6b 0%,#ee5a6f 100%);}
.btn-macro{background:linear-gradient(135deg,#4ecdc4 0%,#44a08d 100%);}
.btn-micro{background:linear-gradient(135deg,#a8e6cf 0%,#7fcdcd 100%);}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;}
.modal-content{position:absolute;top:30%;left:50%;transform:translate(-50%,-30%);background:white;border-radius:20px;padding:30px;width:90%;max-width:400px;}
.modal h3{text-align:center;margin-bottom:20px;}
.modal input{width:100%;padding:15px;border:2px solid #e0e0e0;border-radius:10px;margin-bottom:15px;font-size:16px;}
.modal-buttons{display:flex;gap:10px;}
.modal-btn{flex:1;padding:15px;border:none;border-radius:10px;font-weight:600;cursor:pointer;font-size:16px;}
.btn-primary{background:linear-gradient(135deg,#4CAF50 0%,#45a049 100%);color:white;}
.btn-secondary{background:linear-gradient(135deg,#6c757d 0%,#5a6268 100%);color:white;}
.camera-modal{background:black;}
.camera-container{width:100%;height:100vh;display:flex;flex-direction:column;}
.camera-header{background:rgba(0,0,0,0.8);color:white;padding:15px;display:flex;justify-content:space-between;align-items:center;}
.camera-view{flex:1;position:relative;display:flex;align-items:center;justify-content:center;padding-bottom:140px;}
#video{width:100%;height:100%;object-fit:cover;}
.landscape-hint{position:absolute;bottom:160px;left:120px;background:rgba(0,0,0,0.6);color:#ffeb3b;padding:8px 12px;border-radius:8px;font-size:12px;display:none;}
.camera-controls{background:rgba(0,0,0,0.8);padding:30px;display:flex;justify-content:center;align-items:center;position:fixed;bottom:0;left:0;right:0;z-index:1001;}
.capture-btn{width:80px;height:80px;border-radius:50%;border:5px solid white;background:rgba(255,255,255,0.3);cursor:pointer;position:relative;}
.capture-btn::after{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:60px;height:60px;background:white;border-radius:50%;}
.flash{position:fixed;top:0;left:0;width:100%;height:100%;background:white;opacity:0;pointer-events:none;z-index:9999;}
</style>
</head>
<body>
<div class="container">
 <div class="header"><h1>Pigeon</h1></div>
 <div class="button-grid">
   <button class="photo-btn btn-uputnica" onclick="showPatientInput('uputnica')"><span>UPUTNICA</span><span>ðŸ“„</span></button>
   <button class="photo-btn btn-macro" onclick="showPatientInput('macro')"><span>MAKROSKOPSKA SLIKA</span><span>ðŸ“·</span></button>
   <button class="photo-btn btn-micro" onclick="showPatientInput('micro')"><span>MIKROSKOPSKA SLIKA</span><span>ðŸ”¬</span></button>
 </div>
</div>

<div id="patientModal" class="modal">
 <div class="modal-content">
   <h3 id="patientModalTitle">UPUTNICA</h3>
   <label for="patientNumber">Broj pacijenta:</label>
   <input type="text" id="patientNumber" placeholder="Unesite broj pacijenta..." autofocus>
   <div class="modal-buttons">
     <button class="modal-btn btn-primary" onclick="confirmPatientAndStartCamera()">Pokreni kameru</button>
     <button class="modal-btn btn-secondary" onclick="closePatientInput()">Odustani</button>
   </div>
 </div>
</div>

<div id="cameraModal" class="modal camera-modal">
 <div class="camera-container">
   <div class="camera-header">
     <div class="camera-info">
       <h3 id="cameraTitle">UPUTNICA</h3>
       <p>Pacijent: <span id="cameraPatient"></span></p>
     </div>
     <button class="close-camera" onclick="closeCamera()">âœ•</button>
   </div>
   <div class="camera-view">
     <video id="video" autoplay playsinline></video>
     <div class="landscape-hint" id="landscapeHint"></div>
   </div>
   <div class="camera-controls">
     <button class="capture-btn" id="captureBtn" onclick="capturePhoto()"></button>
   </div>
 </div>
</div>

<div class="flash" id="flash"></div>

<script>
let currentPhotoType='',stream=null;
function showPatientInput(photoType){
 currentPhotoType=photoType;
 const titles={'uputnica':'UPUTNICA','macro':'MAKROSKOPSKA SLIKA','micro':'MIKROSKOPSKA SLIKA'};
 document.getElementById('patientModalTitle').textContent=titles[photoType];
 document.getElementById('patientNumber').value='';
 document.getElementById('patientModal').style.display='block';
}
function closePatientInput(){document.getElementById('patientModal').style.display='none';}
function confirmPatientAndStartCamera(){
 const num=document.getElementById('patientNumber').value.trim();
 if(!num)return;
 closePatientInput();startCamera(currentPhotoType,num);
}
async function startCamera(photoType,patientNumber){
 document.getElementById('cameraPatient').textContent=patientNumber;
 const titles={'uputnica':'UPUTNICA','macro':'MAKROSKOPSKA SLIKA','micro':'MIKROSKOPSKA SLIKA'};
 document.getElementById('cameraTitle').textContent=titles[photoType];
 const hint=document.getElementById('landscapeHint');
 if(photoType==='uputnica'){hint.textContent='ðŸ“± Slikaj uspravno';}
 else{hint.textContent='ðŸ“± Slikaj horizontalno';}
 hint.style.display='block';
 try{
   stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment',width:{ideal:1920},height:{ideal:1080}}});
   document.getElementById('video').srcObject=stream;
   document.getElementById('cameraModal').style.display='block';
 }catch(e){alert('GreÅ¡ka pri kameri: '+e);}
}
function closeCamera(){
 if(stream){stream.getTracks().forEach(t=>t.stop());stream=null;}
 document.getElementById('cameraModal').style.display='none';
}
function capturePhoto(){
 const video=document.getElementById('video');
 const canvas=document.createElement('canvas');
 const ctx=canvas.getContext('2d');
 const vw=video.videoWidth,vh=video.videoHeight;
 if(currentPhotoType==='uputnica'){
   canvas.width=vh;canvas.height=vw;
   ctx.translate(canvas.width/2,canvas.height/2);
   ctx.rotate(90*Math.PI/180);
   ctx.drawImage(video,-vw/2,-vh/2);
 }else{
   canvas.width=vw;canvas.height=vh;
   ctx.drawImage(video,0,0);
 }
 const dataUrl=canvas.toDataURL('image/jpeg',0.8);
 const a=document.createElement('a');
 a.href=dataUrl;a.download=`${document.getElementById('cameraPatient').textContent}_${currentPhotoType}_${Date.now()}.jpg`;a.click();
 closeCamera();
}
</script>
</body>
</html>
